<% if @role.errors.any? %>
    <div class="row">
        <div class="col-sm-12">
            <div class="alert alert-danger">
                <h2>
                    Atenção:
                </h2>
                <ul>
                    <% @role.errors.full_messages.each do | msg | %>
                        <li><%= msg %></li>
                    <% end %>
                </ul>
            </div>
        </div>
    </div>
<% end %>

<div class="row">
    <div class="col-md-10">
        <div class="panel panel-default">
            <div class="panel-body">
                <%= form_for([:management, @role], :html => {class: 'form-horizontal'}) do |f| %>
                    <div class="form-group">
                        <div class="col-md-12">
                            <div style="border-bottom: 2px solid #ddd;">
                                <% if @role.new_record? %>
                                    <h3><i class="fa fa-plus"></i> Novo Perfil</h3>
                                <% else %>
                                    <h3><i class="fa fa-edit"></i> Editar Perfil</h3>
                                <% end %>
                            </div>
                        </div>
                    </div>
                    <div class="form-group" style="padding-top: 10px">
                        <%= f.label :name, '<span style="color:red">*</span> Nome'.html_safe, class: 'control-label col-sm-3' %>
                        <div class="col-sm-7">
                            <%= f.text_field :name, class: 'form-control', placeholder: 'admin', autofocus: true %>
                        </div>
                    </div>

                    <div class="form-group">
                        <div class="col-md-12">
                            <div style="border-bottom: 2px solid #ddd;">
                                <h3><i class="fa fa-key"></i> Permissões</h3>
                            </div>
                        </div>
                    </div>
                    <div class="table-responsive col-sm-10">
                        <table class="table table-striped table-bordered table-list" id="table">
                            <tr>
                                <th></th>
                                <th>Visualizar</th>
                                <th>Cadastrar</th>
                                <th>Editar</th>
                                <th>Excluir</th>
                                <th>Importar</th>
                            </tr>
                            <%

                                # cria um nobo array, uma nova variavel @actions. As informações colocadas vão ser perdidas nos checkbox. Se eu faz redirect_to a mesma coisa acontece. Como manter as informações?

                                # as informações do chechbox que não são selecionados, não estão sendo enviados. Como mandar sempre todos os checkbox, mesmo não sendo selecionados? (Feito)

                                # como fazer a validação desses checkbox?
                            %>
                            <% @sessions.each_with_index do |session,i| %>
                                <tr>
                                    <td><%=  session[:name] %></td>
                                    <%= f.fields_for "permission[#{i}]", @role.permissions[i] do |permission_form| %>
                                        <td>
                                          <% unless session[:permissions].index(:new).nil? %>
                                            <%= permission_form.hidden_field :id %>
                                            <%= permission_form.hidden_field :index, :value => ""  %>
                                            <%= permission_form.check_box :index, {class: 'checkbox'} %>
                                          <% end %>
                                        </td>
                                        <td>
                                            <%= permission_form.hidden_field :new, :value =>  "" %>
                                            <%= permission_form.check_box :new, {class: 'checkbox'} %>
                                        </td>
                                        <td>
                                            <%= permission_form.hidden_field :edit, :value =>  "" %>
                                            <%= permission_form.check_box :edit, {class: 'checkbox'} %>
                                        </td>
                                        <td>
                                            <%= permission_form.hidden_field :remove, :value =>  "" %>
                                            <%= permission_form.check_box :remove, {class: 'checkbox'} %>
                                        </td>
                                        <td>
                                          <% unless session[:permissions].index(:import).nil? %>
                                            <%= permission_form.hidden_field :import, :value =>  "" %>
                                            <%= permission_form.check_box :import, {class: 'checkbox'} %>
                                          <% end %>
                                        </td>
                                    <% end %>
                                </tr>
                            <% end %>
                        </table>
                    </div>

                    <div class="form-group pull">
                        <div class="col-sm-offset-3 col-sm-7">
                            <div class="pull-right">
                                <%= link_to 'Voltar', management_roles_path, class: 'btn btn-danger' %>
                                <% if @role.new_record? %>
                                    <%= f.submit 'Cadastrar', class: 'btn btn-green' %>
                                <% else %>
                                    <%= f.submit 'Editar', class: 'btn btn-green' %>
                                <% end %>
                            </div>
                        </div>
                    </div>
                <% end %>
            </div>
        </div>
    </div>
</div>
